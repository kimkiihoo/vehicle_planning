# 算法原理介绍

本项目实现了一个非结构化环境下的车辆轨迹规划与优化系统。主要包含两个阶段：
1.  **初值规划**：使用混合 A* (Hybrid A*) 算法生成一条无碰撞、符合车辆运动学的粗糙路径。
2.  **后处理优化**：使用 DL-IAPS 和 PJSO 算法对路径进行平滑和速度规划，生成高质量的轨迹。

## 1. 混合 A* (Hybrid A*)

混合 A* 是一种结合了传统 A* 搜索和车辆运动学模型的路径规划算法。
-   **节点扩展**：不像传统 A* 只在栅格中心移动，混合 A* 的节点包含 $(x, y, \theta)$，并根据车辆的运动学方程（如 Reeds-Shepp 曲线或单纯的转向模型）进行连续坐标的扩展。
-   **启发式函数**：通常结合了两种启发式：
    -   Non-holonomic cost: 考虑车辆运动约束的 Reeds-Shepp 距离。
    -   Holonomic cost: 考虑障碍物的 2D Dijkstra 距离。
-   **解析扩展 (Analytic Expansion)**：在搜索过程中，定期尝试使用 Reeds-Shepp 曲线直接连接当前点和终点，以提高搜索效率和精度。

## 2. 轨迹优化 (Trajectory Optimization)

为了让生成的轨迹更加平滑且舒适，我们引入了基于数值优化的后处理模块 `TrajectoryOptimizer`。

### 2.1 路径平滑 (DL-IAPS)

**DL-IAPS (Dual-Loop Iterative Anchoring Path Smoothing)** 是一种双层循环的路径平滑算法。
-   **原理**：
    -   **内层循环**：构建一个二次规划 (QP) 问题，目标是最小化路径的平滑度（曲率/加速度）以及与原路径的偏差。约束条件是路径点必须限制在以原路径点为中心的安全框 (Safety Box) 内。
    -   **外层循环**：求解 QP 后，检查新路径是否与障碍物碰撞。如果某点发生碰撞，则缩小该点对应的安全框大小，并重新进入内层循环求解。
-   **优势**：保证了优化的凸性 (Convexity) 和求解速度，同时确保了安全性。

### 2.2 速度规划 (PJSO)

**PJSO (Piece-wise Jerk Speed Optimization)** 用于在已知几何路径的基础上生成最优速度曲线。
-   **变量**：距离 $s$、速度 $v$、加速度 $a$。
-   **目标函数**：最小化加加速度 (Jerk)、加速度甚至与参考速度的偏差。
-   **约束条件**：
    -   **动力学约束**：$s, v, a$ 之间的积分关系（通常使用梯形积分）。
    -   **物理限制**：最大速度、最大加速度/减速度。
    -   **曲率限制**：在高曲率路段限制最大速度 ($v^2 \kappa \le a_{lat,max}$)，防止侧向加速度过大。
-   **结果**：生成包含时间戳 $t$、位置 $(x,y,\theta)$、速度 $v$、加速度 $a$ 的完整轨迹。
